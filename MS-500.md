 Microsoft 365 Security Administration
 
 
Course concepts 
-	Implement and manage identity and access (30-35%) 
-	Implement and manage threat protection (20-25%) 
-	Implement and manage information protection (15-20%) 
-	Manage governance and compliance features in Microsoft 365 (25-30%) 



# Implement and manage identity and access 
Microsoft Azure have many capabilities that can help protect the organization. These capabilities comes in form of controls. 

### Device controls 
Intune device configuration, are policy controls for devices such as password, Encryption and health. 
Windows Device guard, allows only trusted application which if define by admin. 
Boot secure, Ensure that boot image is validate. 
Azure AD conditional, Allow the controls of only access from managed devices.
	
### Email controls
That are many ways an attack can gain access to the organization by sending malicious emails [[Social engineering]]. Microsoft have multiple controls to help protect against these kind of attacks. **Exchange Online protection** scan the emails attachment and url for any malicious intend.  **Office 365 Advance threat protection** and **Windows defender smartScreen** are protection controls after the email have been delivered. Advance threat protection protect the user against link and files if the user click on them and there malware, and stop the application before the malware is delivered. SmartScreen is a warning to the user of potentiate malware. 


### User controls
User account is critical they are protected as they are the way employee [[Authentication]] and [[Authorization]] to the organization and the resources they need access too, for this reason multiple controls have been created to help protect user. [[MFA]] can be setup ensuring that stealing the password is not enough, to gain access. **Azure AD password protection** are the policy for passwords with controls to password requirement, force password reset on leaked passwords. **Azure AD Smart Account Lockout** are controls for when account should be locked when high-risk activity occurs. 

#### User risk policy 
The User risk policy it the control of how to handle people with is caracteres as potentially compromised within a rank of low, medium and high. The policy allows for either blocking a user access based on the risk or forcing the user to change password and there by mitigating the risk of compromise. 
When auditing user risk, it possible to set the alert to true or false positive. The more risks you audit the better the system get a rating further risk alerts base on machine learning
	
### Malware Controls
Application installed on machines can include malware in form of virus, spyware, ransomware, etc. here controls such as **Device guard** can help by only allowing trusted application which is defined by the organization. **Windows defender Antivirus** is 365 [[Anti-virus]].**Windows Firewall** [[Firewall]] protect against unauthorized access. 
	
### Lateral movement 
If Attacker gain access to a device lateral movement control have to be put in place to ensure that the attack does not spread to other systems. **Cloud app Security** alerts on activity is deems suspicious. **Credential Guard** prevents attack from gaining access to other resource using method Pass-the-hash or Pass-the-Ticket.
	
###  Data exfiltration
To help organization to protect their data, Microsoft have create controls to classify and encrypt the data. **Windows information protection** protect files with encryption to limit data leakages. **Exchange mail flow rules** help prevent forwarding rules to external domains. **Azure Information Protection and Azure
Rights Management**  encrypts and permissions sensitive files. Protection travels with the files. **Azure technologies** provide encryption for disks and storage, SQL Encryption, and Key vault. *SQL Database dynamic data masking* limits sensitive data exposure by masking it to non-privileged users. **SQL Threat Detection** alerts on suspicious database activities, potential vulnerabilities, and SQL injection attacks, as well as anomalous database access patterns. **Azure Backup** is a service you can use to back up and restore your data in the Microsoft cloud. This service includes capabilities to protect your backups from ransomware. 
	
	
	
## Deployment plan 
### Authentication	
The plan for how user will [[Authentication]] to the organization is important to ensure that legit user have access the resources they need, while also keeping all other out. [[MFA]] controls can be put in place to protect the user in [[Brute force]], leaked, etc. **Conditional access** is a conditional control for who can access cloud app. If you want the organization to be event more protected passwordless deployment using Authenticator app or FIDO2 Security key, this is also a benefit for user as they no longer have to remember passwords. 

|Bad|Good|Better|Best|
|---|---|---|---|
|weak password|sms| Microsoft auth|Windows hello|
||Voice|Software token OTP| Microsoft authn sign in|
|||Hardware token OTP| FIDO2 security key|

### Application and device 
When deploying application how user should [[Authentication]] to the application is important, an good option is [[SSO]], help the user by not having to type in the password multiple times. 

### Governance and reporting
**Privileged Identity Management** Is a administration tools for roles, It have controls such as [[Just-in-time]] access. access review that can help review access to resources. 

### Privileged Identity Management
The purpose of Privileged Identity Management (PIM) to to minimize the number of users that have access to information or resources. 
PIM is a tools in azure AD to mange azure role access, and notify when a role is activated. There are multiple time and approval based controls in PIM to mange the access to role, one such thing is [[Just-in-time]] access, access review, access justification, the requirement for MFA and many more. 
Everything get logged in the azure audit logs allowing the admin to review history. 
It is Microsoft recommendation to implement the roles with a most to least access priority. 
It is recommended to read through all audit events on weekly basis and export the event on a monthly basis. 

### Azure AD connect sync
Takes care of syncing [[AD]] data between the Azure AD and on-premise environment. 


### Azure Active Directory Connect health 
Send email notification when the Azure Ad health status decrease 

### Dynamic membership rules for groups in azure AD
Allows the administrator to dynamically handle roles depending on conditions of either the users or devices, setup by the administrator. 
The system change the system or user each time the attributes get updated to check if any roles need to be added or removed. 

### Azure AD Self-service password reset 
GIves user the ability to change their password without help from service desk or administrator. Admin of the Azure AD have the option to enable self-service of password change. during this process the admin can setup what authentication method are available and how many is required to be allowed to reset one password. The option is between 1 or 2. It also possible to setup email notification when a user password is changed they receive a mail notifying them their password have been changed. Equally it possible for admin to be notified with an admin have reset their password. 
Unlocking of the account can also be done through self-service following the same method as reset password. 


### Azure AD access review
Allow organization to manage group memberships. This is important when it comes to user that switch team or guest account, ensuring they only have access as long as they need it. With access review control administrator can put the responsibility of the group management to the group owner. Beside group owner you can also assign it to specific user or self-review. 

### Azure AD [[MFA]]
Multi-Factor Authentication is an additional safe guard to user. **Conditional Access** is used to configuration when user need to provide MFA, which user is effected by the policy, there also the conditional for user not needing to use MFA from trusted location.  
Conditional access policies can be setup to require password reset, in case of high risk sign-in or if Azure have defines the user as a high risk of compromise. 

### Passwordless [[Authorization]] implementation 
Authentication methods policy is where admin have the ability to roll out [[FIDO2]] and Microsoft authenticator to both selected user and all user. For Microsoft authenticator to be used as passwordless, MFA need to be enabled. 
It possible to require people to register for both MFA and self-service at registration point. 

### Azure reports & logs
Using Azure AD portal, administrators have the ability to see the logs of user sign-ins and if MFA was used or not. It a good way to get any indication how MFA configuration have effected the organization. 
Azure also give Risk reports, which comes in two varies Risky user, which is user Azure presumes are compromised, and risky sign-ins which it sign of user sign-in which Azure deems to be risky this could be a new sign-in location. 



### Manage user authentication methods 
Azure AD portal allows administrator to manage user [[MFA]], With tools such as disable devices, require user to provide contact methods, add multi-factor by providing phone number.


### Emergency account
When starting to configure **Conditional access** policies it important to have admin account that are excepted from access policies, ensuring that there is always access to the Azure in case if policies get configured in such a way that lock out the access for user. In these cases the *emergency account* will be used to reconfigure the policies giving access to the domain again to the users. 

### Intune
Where Conditional access is policies related to the connection, eg. Location, User, MFA, Risk etc. Intune is policies related to the device used to connect to the organization. And if the device is compliance with the organization requirement. e.g Latest security update, Anti-virus, etc.

### managed devices 
Are devices that is under the organization control, by either being domain joined, or hybrid Azure AD joined, when setting access control to only manage devices but not tell is the GPO have been applied to the devices. An way to help with this is by requiring the devices to be marked as compliant, Intune can be used to validate that the device is compliance.


### Azure RBAC 
Role base access control of how permissions are enforced. an role consists of three elements : security principal, role definition and scope.  
Security principal is who the target this can be a user, group service principal or manged identity. Role is what they are allow to do, read, write, etc. And scope is what resources the access control applies to. 
Admins in Azure allows for assignment of roles to users. In Azure admin role is split up by product (eg. Exchange admin, User admin, Office admin, ATP admin, etc. ) allowing user to only be admin of a particular product. It important to note that only admin can reset another admin accounts. for that reason there should be more then one global admin account, in case of compromise and lost of password. 


### Azure logs 
Azure activity logs are stored for up 90 days. The activity log can be view in two ways with the web interface on azure under resource group -> activity log, the log file can also be downloaded as a csv file.  The other option is to use Azure power shell with the Get-AzLog command.

# Implement and manage threat protection 

### Azure ATP 
Azure ATP is a security cloud-based tools which uses the signals from [[AD]] to identify, detect and investigate advance threats. It also have the possibility to protect user by creating a baseline for each user, can alerting when deviation occurs from the baseline, that is view as potential risk. AD FS protection by detecting attacks and providing visibility into authentication events generated by the AD FS. Identifying rogue user and attacks. Lateral movement detection. And security recommendation to improve the network security. 
The Azure ATP sensor can be installed directly on the domain controller, without the need for another server or port mirroring, another possibility is the AD FS server for monitoring network and authentication events 
Core function of ATP sensor 
	-	Capture and inspect network traffic from the domain controller
	-	Event logs from domain controller
	-	[[RADIUS]] accounting information for VPN connection 
	-	Retrieve data for user and computer from domain controller
	-	Perform resolution for identifying network entities
	-	Transfer data to defender cloud solution 
	-	The user running the sensor can either be an domain account or a group managed service account, with the read rights to all objects in the AD. 

#### License 
The license required to have access to defender ATP is enterprise mobility + security 5 (EMS S5)

#### Health center 
The Microsoft Defender for Identity health center lets you know how your Defender for Identity instance is performing and alerts you when there are problems.


#### Treat and vulnerability management
Help detect and prioritize vulnerability on the organization devices and comes with remediation to fix the problem. 

#### Attack surface reduction
Is a set of control on the organization endpoints which help ensuring the devices are properly configuration to  protect the device for possible malware, Network protection and web protection is also included. Configuration of Attack surface reductions is done by either using GPO or Powershell commands. 


#### Advance hunting
Advance hunting allows an analyst to use a query structure language to search for breach, malware and create custom detection rules. 

#### Automated investigation and remediation
Defender off automatic investigation and remediation capabilities that help reduce the volume of alerts. 

#### Device security score
Help the analyst evaluate the devices security state. 

#### Threat expert
Set of expert deployed by Microsoft which empowers the analyst to response faster and more accurate to threats

#### Onbord machines to ATP
Under setting -> Onboarding is there a guide for how to onboard machines to ATP, which can be done in a few difference ways, e.g script, GPO or Intune. 


#### Roles
Roles in ATP comes with two controls, what they can do( Investigate alerts , remediation and security controls) the other is the scope of what machines they can perform these action on. this is done by creating machine groups and adding the machines by tagging them. The goal of roles in ATP is to have a tier level role structure. 

#### API 
Defender ATP API allows the user to automate and integrate ATP with any solution, The ATP API uses a REST model with a JSON format for request and response. It also have integrated support for SEIM solution such as ELK.


#### Application Guard
Application guard protect the organization by opening untrusted sites in a hyper-v container. When visiting a site not listed in the isolated network boundaries, the machine will open the site in a hyper-v virtual browner.  Network boundaries and configured in device configuration. It can also be implemented for files to be run in a virtual container, it switches things around assuming everything in untrusted until proven otherwise. 

### Intunes
Intunes is an way to manage mobile app or devices. This is done using policies mobile device management (MDM) policy are policies for devices which have been enrolled into Azure Intunes which allows IT administration to manage the devices, setting policy for minimum version, requirement to apple face id or android bio. They also have the option to wipe the device for any data or selective data. 
App protection policy is the control the IT admin have over app that can be controlled Intunes such as Microsoft office product, here IT can ensure that document does not get stored on the local device or other storage out of cooperation control. Further more the control for limited copy/past to other application. To further protect the data the option for PIN can be setup, requiring the user to insert a pin when they want access to the data, this pin is shared among all apps, giving better user experience. The pin is also stored in such a way that other intunes app also have access to the PIN or required PIN input when other apps are opened. 
Intunes also allows for deployment of application on windows 10, android and IOS devices. When deploying of application can both be an requirement or optional, when required the device will try and install the application itself. It also possible for an organization to deploy their own application through Intunes. 

### Windows Information Protection (WIP)
WIP is an part of Intunes and there for an requirement before WIP can be used. The way WIP works is  by restricting how the employee can work with the organization data. This is done by seperating personal and company data and app. 
e.g. only allowing company data to be copy/paste to company managed application and ensuring the data can only be stored on company controlled cloud solutions. 

### Exchange online protection 
Is Microsoft method of using SPF, DKIM, DMARC record in the [[DNS]] to authenticate the sender of the emails ensuring that it have not been spoofed. This is done by the recipient email system can validate the email. 

#### Safe attachments 
Safe attachments is done by Microsoft on inbound mails, scanning them in a virtual environment for malware. To ensure quick delivery of mail there is the possibility of replacing the attachment with placeholder before they are scanning and then available there the file has been scanned. If the file is of the type pfd, word, excel or similar it possible to get a preview of the content. If the file is then deemed malicious it get send to quarantine, where only admin have the option to release the email or delete it. 


#### ATP safe link 
Works on Outlook, Teams and office 365 apps. There are multiple way safe link policies can be configured, If the url or domain is either blocked or suspicious, The message is either block or the link is rewritten to Microsoft safe link, protecting the user. It also possible for the admin to only allow email through once the link in the mail have been scanned. In the cases where the link lead to downloadable file the content of the file will then be scanned. 

#### Attack simulations 
Allows the admin to simulate attacks against their own organization, to help identify vulnerabilities in human training and prepare them before an real attack happens.  

## Azure sentinel 
Azure sentinel is Azure SIEM/SOAR tool which allows to integration from multiple sources to be injected into the SIEM  data warehouse, the the data can be aggregated and searched through. With playbooks you can setup automatic process when certain event happens or manual activated. This include sending a message on Team to the SOAR group, creating an ticket in service now, once the event have been closed so is the event in service now. Workspace is Azure way to creating custom dashboards based on the data that have been injected. 

#### Lockbox 
when turned on customer Lockbox ensures that Microsoft cannot access your content to perform a service operation without your explicit approval. Customer Lockbox brings you into the approval workflow for requests to access your content.
The time frame which the engineer has to fix the problem is four hours, there after the connection is cut weather the problem is fix or not. The lockbox apply to exchange, sharepoint and OneDrive. 

### B2B
Is a method of business to cooperate with each other, the way B2B works is by setting up a guest account for the external business. the partner uses their own identity management solution, so there is no external administrative overhead for your organization. Guest users sign in to your apps and services with their own work, school, or social identities. There no requirement for it to be Azure AD 


### Azure information Protection (AIP)
AIP help protect information by giving the content a label that describe the sensitivity of the content in the file. All this is done automaticly to help the organization discover, Classify and protect the information. Once the document is shared outside the organization it is still protected. It also allows the auther of the document to follow who is viewing the document and revoke access to the document if suspected that it got accessed by the wrong people. If automation is setup to classify the document it possible for the user to overwrite the classification if they think it wrong. 
The label is setup in the AIP portal it up to the organization to create the label they need and if there need to be visible marking on the document of the label e.g. watermarking. It also here one describe who can access the document and what action they can take. 

### Data loss prevention
Is a Microsoft office 365 tools to help the organization ensuring the document that leave the organization through exchange gets threaten the correct way, (Blocking, encryption, notify admin or tip the user is about the break the rules.)
The DLP solution comes with built in template the support regulation such as HIPPA it also possible for the organization to either create their own or use the existing template and tweak them to better suit the company. 
DLP scans both existing and new document in Sharepoint and Onedrive but for email it only scan new email for sensitive information 

### Desktop Analytics
Desktop Analytics is a cloud-based service that integrates with Configuration Manager. The service provides insight and intelligence for you to make more informed decisions about the update readiness of your Windows clients. It combines data from your organization with data aggregated from millions of devices connected to Microsoft cloud services. everything happens in three stages prepare, pilot and deployment. when creating a new deployment plan for a windows updates, the creator of the plan need to look through application to ensure the functionality of the application after the update. This is done by desktop analytic look through the application of the devices that are part of the deployment plan, the user then need to look through the application and mark them as ready for update. 